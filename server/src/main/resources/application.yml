spring:
  application:
    name: rwa-server
  config:
    import: optional:file:.env[.properties],optional:file:server/.env[.properties]
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/rwa}
    username: ${DB_USER:rwa}
    password: ${DB_PASSWORD:rwa_password}
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
    open-in-view: false
  flyway:
    enabled: true
    locations: classpath:db/migration
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
    consumer:
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      enable-auto-commit: false
      auto-offset-reset: earliest
    listener:
      ack-mode: manual_immediate

server:
  port: ${SERVER_PORT:8080}

management:
  endpoints:
    web:
      exposure:
        include: ${MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE:health,info,prometheus}
  endpoint:
    health:
      show-details: ${MANAGEMENT_ENDPOINT_HEALTH_SHOW_DETAILS:never}
      probes:
        enabled: ${MANAGEMENT_ENDPOINT_HEALTH_PROBES_ENABLED:true}
  metrics:
    distribution:
      percentiles-histogram:
        "[http.server.requests]": true
      percentiles:
        "[http.server.requests]": 0.95,0.99

rwa:
  shared-dir-path: ${SHARED_DIR_PATH:../shared}
  giwa-rpc-url: ${GIWA_RPC_URL:https://sepolia-rpc.giwa.io}
  giwa-chain-id: ${GIWA_CHAIN_ID:91342}
  master-key-base64: ${MASTER_KEY_BASE64:}
  issuer-private-key: ${ISSUER_PRIVATE_KEY:}
  treasury-private-key: ${TREASURY_PRIVATE_KEY:}
  admin-api-token: ${ADMIN_API_TOKEN:}
  service-token: ${SERVICE_TOKEN:}
  service-token-header: ${SERVICE_TOKEN_HEADER:X-Service-Token}
  internal-paths: ${INTERNAL_PATHS:/internal/**}
  nonce-lock-timeout-ms: ${NONCE_LOCK_TIMEOUT_MS:5000}
  auth:
    mode: ${AUTH_MODE:JWKS}
    jwks-url: ${AUTH_JWKS_URL:}
    jwt-issuer: ${AUTH_JWT_ISSUER:rwa-id-server}
    jwt-audience: ${AUTH_JWT_AUDIENCE:rwa-custody}
    clock-skew-seconds: ${AUTH_CLOCK_SKEW_SECONDS:60}
    required-paths: ${AUTH_REQUIRED_PATHS:/trade/**,/me/**,/wallet/**}
    jwks-cache-seconds: ${AUTH_JWKS_CACHE_SECONDS:600}
    hmac-secret-base64: ${AUTH_HMAC_SECRET_BASE64:}
    local-auth-enabled: ${LOCAL_AUTH_ENABLED:false}
  integration:
    wallet-create:
      topic: ${WALLET_CREATE_TOPIC:wallet-create}
      consumer-group: ${WALLET_CREATE_CONSUMER_GROUP:custody-consumer-group}
      result-topic: ${WALLET_CREATE_RESULT_TOPIC:wallet-create-result}
      retry-interval-ms: ${WALLET_CREATE_RETRY_INTERVAL_MS:1000}
      retry-max-attempts: ${WALLET_CREATE_RETRY_MAX_ATTEMPTS:10}
      dlq-topic: ${WALLET_CREATE_DLQ_TOPIC:wallet-create.dlq}
      concurrency: ${WALLET_CREATE_CONCURRENCY:3}
  gas-sponsor:
    enabled: ${GAS_SPONSOR_ENABLED:true}
    station-private-key: ${GAS_STATION_PRIVATE_KEY:}
    station-initial-grant-wei: ${GAS_STATION_INITIAL_GRANT_WEI:1000000000000000}
    station-topup-target-wei: ${GAS_STATION_TOPUP_TARGET_WEI:1000000000000000}
    station-dust-reserve-wei: ${GAS_STATION_DUST_RESERVE_WEI:300000000000000}
    estimate-multiplier: ${GAS_ESTIMATE_MULTIPLIER:1.2}
    max-fee-base-multiplier: ${MAX_FEE_BASE_MULTIPLIER:2.0}
    max-priority-fee-wei: ${MAX_PRIORITY_FEE_WEI:100000000}
    l1-fee-oracle-address: ${L1_FEE_ORACLE_ADDRESS:}
    l1-fee-multiplier: ${L1_FEE_MULTIPLIER:1.2}
    topup-confirmations: ${GAS_TOPUP_CONFIRMATIONS:1}
  tx:
    confirmations: ${TX_CONFIRMATIONS:12}
    polling-interval-ms: ${TX_POLLING_INTERVAL_MS:5000}
    default-gas-limit: ${TX_DEFAULT_GAS_LIMIT:800000}
  outbox:
    kafka-enabled: ${OUTBOX_KAFKA_ENABLED:true}
    default-topic: ${OUTBOX_DEFAULT_TOPIC:server.domain.events}
    retry-min-age-minutes: ${OUTBOX_RETRY_MIN_AGE_MINUTES:10}
    max-attempts: ${OUTBOX_MAX_ATTEMPTS:30}
    retry-interval-ms: ${OUTBOX_RETRY_INTERVAL_MS:60000}
    lock-ttl-seconds: ${OUTBOX_LOCK_TTL_SECONDS:300}
    claim-batch-size: ${OUTBOX_CLAIM_BATCH_SIZE:100}
    backoff-seconds: ${OUTBOX_BACKOFF_SECONDS:60}
    publisher-executor:
      core-pool-size: ${OUTBOX_PUBLISHER_CORE_POOL_SIZE:4}
      max-pool-size: ${OUTBOX_PUBLISHER_MAX_POOL_SIZE:8}
      queue-capacity: ${OUTBOX_PUBLISHER_QUEUE_CAPACITY:200}
