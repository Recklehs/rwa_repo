{
  "info": {
    "_postman_id": "35f359ff-71ce-4b89-920b-18ce5b0210a1",
    "name": "E2E Legacy CryptoOrder",
    "description": "Legacy account/bank compatibility checks",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "01 Legacy Signup (/api/auth/signup)",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const runId = pm.variables.replaceIn('{{$guid}}');",
              "pm.collectionVariables.set('legacy_login_id', `legacy_${Date.now()}`);",
              "pm.collectionVariables.set('legacy_password', 'Passw0rd!123');",
              "pm.collectionVariables.set('legacy_phone', `010-${Math.floor(1000+Math.random()*9000)}-${Math.floor(1000+Math.random()*9000)}`);",
              "pm.collectionVariables.set('legacy_name', 'Legacy User');",
              "pm.collectionVariables.set('legacy_birth_date', '1993-01-01');",
              "pm.collectionVariables.set('legacy_run_id', runId);"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
              "const j = pm.response.json();",
              "pm.collectionVariables.set('legacy_user_hex_id', j.userHexId || '');",
              "pm.test('legacy fields exist', function () {",
              "  pm.expect(j.userHexId).to.be.a('string');",
              "  pm.expect(j.userName).to.be.a('string');",
              "  pm.expect(j.phoneNumber).to.be.a('string');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"{{legacy_name}}\",\n  \"phone\": \"{{legacy_phone}}\",\n  \"birthDate\": \"{{legacy_birth_date}}\",\n  \"loginId\": \"{{legacy_login_id}}\",\n  \"password\": \"{{legacy_password}}\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{cryptoorder_base_url}}/api/auth/signup"
      }
    },
    {
      "name": "02 Legacy Login (/api/auth/login)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
              "const j = pm.response.json();",
              "pm.test('legacy login fields exist', function () {",
              "  pm.expect(j.userHexId).to.be.a('string');",
              "  pm.expect(j.userName).to.be.a('string');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"loginId\": \"{{legacy_login_id}}\",\n  \"password\": \"{{legacy_password}}\"\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{cryptoorder_base_url}}/api/auth/login"
      }
    },
    {
      "name": "03 Legacy Account Balance (/api/account/{id}/balance)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          { "key": "Authorization", "value": "Bearer {{bearer_token}}" }
        ],
        "url": "{{cryptoorder_base_url}}/api/account/{{account_id}}/balance"
      }
    },
    {
      "name": "04 Legacy Deposit (/api/bank/deposit)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{bearer_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"accountId\": \"{{account_id}}\",\n  \"amount\": 1000\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{cryptoorder_base_url}}/api/bank/deposit"
      }
    },
    {
      "name": "05 Legacy Withdraw (/api/bank/withdraw)",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{bearer_token}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"accountId\": \"{{account_id}}\",\n  \"amount\": 500\n}",
          "options": { "raw": { "language": "json" } }
        },
        "url": "{{cryptoorder_base_url}}/api/bank/withdraw"
      }
    }
  ]
}
